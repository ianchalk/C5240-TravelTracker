import{e as i,g as s,k as e,o as n,r as u,u as c,xa as o}from"./chunk-2RWO4YJT.js";var a=class r{constructor(t){this.http=t;console.log("AuthService initialized"),this.checkAuthStatus().subscribe(),document.addEventListener("visibilitychange",()=>{document.hidden||(console.log("Page became visible - checking auth status"),this.checkAuthStatus().subscribe())})}baseUrl="https://traveltracker2025.azurewebsites.net/auth";currentUserSubject=new i(null);isAuthenticatedSubject=new i(!1);currentUser$=this.currentUserSubject.asObservable();isAuthenticated$=this.isAuthenticatedSubject.asObservable();checkAuthStatus(){return this.http.get(`${this.baseUrl}/status`,{withCredentials:!0}).pipe(n(t=>{console.log("Auth status check result:",t),this.isAuthenticatedSubject.next(t.isAuthenticated),this.currentUserSubject.next(t.user)}),e(t=>(console.error("Auth status check failed:",t),this.isAuthenticatedSubject.next(!1),this.currentUserSubject.next(null),s({isAuthenticated:!1,user:null}))))}getCurrentUser(){return this.http.get(`${this.baseUrl}/user`,{withCredentials:!0}).pipe(e(t=>{throw console.error("Get current user failed:",t),t}))}loginWithGoogle(){console.log("Initiating Google login..."),window.location.href=`${this.baseUrl}/google`}logout(){console.log("Logging out..."),this.http.get(`${this.baseUrl}/logout`,{withCredentials:!0}).pipe(n(()=>{this.isAuthenticatedSubject.next(!1),this.currentUserSubject.next(null)}),e(t=>(console.error("Logout failed:",t),this.isAuthenticatedSubject.next(!1),this.currentUserSubject.next(null),s(null)))).subscribe(()=>{window.location.href="/"})}get currentUser(){return this.currentUserSubject.value}get isAuthenticated(){return this.isAuthenticatedSubject.value}static \u0275fac=function(l){return new(l||r)(c(o))};static \u0275prov=u({token:r,factory:r.\u0275fac,providedIn:"root"})};export{a};
